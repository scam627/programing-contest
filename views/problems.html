<!DOCTYPE html>
<html>
	<head>
		<!-- Import Google Icon Font -->
		<link
			href="https://fonts.googleapis.com/icon?family=Material+Icons"
			rel="stylesheet"
		/>
		<!-- Import materialize.css -->
		<link
			type="text/css"
			rel="stylesheet"
			href="../css/materialize.min.css"
			media="screen,projection"
		/>

		<!-- Let browser know website is optimized for mobile -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>

	<body>
		<center>
			<h1>Search your problems</h1>
		</center>
		<br />
		<div class="container">
			<br />
			<div class="row">
				<ul class="collection with-header">
					<li class="collection-header">
						<div class="row">
							<div class="col s12">
								<div class="row">
									<div class="input-field col s12">
										<i
											onclick="searchProblems()"
											class="waves-effect material-icons prefix"
											>search</i
										>
										<input
											type="text"
											id="autocomplete-input"
											class="autocomplete"
										/>
										<label for="autocomplete-input">Autocomplete</label>
									</div>
								</div>
							</div>
						</div>
					</li>
					<div id="problems"></div>
				</ul>
				<center>
					<ul class="pagination" id="pages">
						<li class="waves-effect">
							<a name="decrement" onclick="updatePage(this.name)"
								><i class="material-icons">chevron_left</i></a
							>
						</li>
						<li class="active">
							<a id="current-page" onclick="">1</a>
						</li>
						<li class="waves-effect">
							<a name="increment" onclick="updatePage(this.name)"
								><i class="material-icons">chevron_right</i></a
							>
						</li>
					</ul>
				</center>
			</div>
		</div>
		<div class="fixed-action-btn">
			<a class="btn-floating btn-large red">
				<i class="large material-icons">keyboard_arrow_left</i>
			</a>
			<ul>
				<li>
					<a class="btn-floating yellow" href="./statics.html"
						><i class="material-icons">insert_chart</i></a
					>
				</li>
				<li>
					<a class="btn-floating green"
						><i class="material-icons">list_alt</i></a
					>
				</li>
				<li>
					<a class="btn-floating blue" href="../index.html"
						><i class="material-icons">visibility</i></a
					>
				</li>
			</ul>
		</div>
		<!-- JavaScript at end of body for optimized loading -->
		<script type="text/javascript" src="../index.js"></script>
		<script type="text/javascript" src="../js/materialize.min.js"></script>
		<script>
			let currentPage = 1;
			let maxPage = 1;
			let problems;
			function searchProblems() {
				let tag = document.getElementById("autocomplete-input").value;
				ajaxGet(
					`https://codeforces.com/api/problemset.problems?tags=${tag}`,
					resp => {
						let response = JSON.parse(resp);
						problems = response.result.problems;
						maxPage = problems.length / 10 + (problems.length % 10 > 0);
						console.log(problems.length);
						console.log(maxPage);
						resetPages();
						deployProblems();
					}
				);
			}

			function deployProblems() {
				let deployTag = document.getElementById("problems");
				deployTag.innerHTML = "";
				for (let i = 10 * (currentPage - 1); i < currentPage * 10; i++) {
					const obj = problems[i];
					const url = `https://codeforces.com/contest/${obj.contestId}/problem/${obj.index}`;
					const newNode = `
							<li class="collection-item">
								<div>
									${obj.name}
									<a href="${url}" class="secondary-content"><i class="material-icons">send</i></a>
							</div>
						</li>`;
					deployTag.insertAdjacentHTML("beforeend", newNode);
				}
			}

			function resetPages() {
				let currentTag = (document.getElementById("current-page").text = 1);
				currentPage = 1;
			}

			function updatePage(action) {
				let currentTag = document.getElementById("current-page");
				if (action == "increment" && currentPage < maxPage)
					currentTag.text = ++currentPage;
				if (action == "decrement" && currentPage > 1)
					currentTag.text = --currentPage;
				deployProblems();
			}
		</script>
	</body>
</html>
